<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F-Lambda | Sovereign Documentation Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Noto+Sans+Arabic:wght@300;600&display=swap');
        body { font-family: 'Space Grotesk', 'Noto Sans Arabic', sans-serif; background-color: #050505; color: #ced4da; margin: 0; overflow: hidden; }
        .equation-box { background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%); border: 1px dashed rgba(99, 102, 241, 0.3); }
        .neon-border { border: 1px solid rgba(99, 102, 241, 0.2); transition: all 0.3s ease; }
        .neon-border:hover { border-color: #6366f1; box-shadow: 0 0 15px rgba(99, 102, 241, 0.1); }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #1e1e1e; }
        .logic-gate { border-right: 2px solid #6366f1; padding-right: 1rem; margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div id="root" class="h-screen"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [apiKey, setApiKey] = useState(localStorage.getItem('f_lambda_key') || '');
            const [showAuth, setShowAuth] = useState(!apiKey);
            const [messages, setMessages] = useState([
                { id: 1, role: 'ai', text: 'تم تفعيل بروتوكول التوثيق السيادي. معادلة الكون الموحد لـ F-Lambda قيد التشغيل: N → [τs] → ID ← [G] → N\'' }
            ]);
            const [input, setInput] = useState("");
            const [isComputing, setIsComputing] = useState(false);
            const chatRef = useRef(null);

            const F_CONST = 15.0725;

            useEffect(() => {
                chatRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [messages]);

            const executeQuery = async () => {
                if (!input.trim() || !apiKey) return;
                const userMsg = { id: Date.now(), role: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput("");
                setIsComputing(true);

                try {
                    const systemPrompt = `أنت العقل المدبر لنظام F-Lambda. الثابت الفيزيائي الحاكم هو ${F_CONST}. المعادلة الأساسية هي N -> [τs] -> ID <- [G] -> N'. رد على استفسارات المهندس بصرامة علمية وتحليل هندسي عميق. استخدم مصطلحات مثل (فضاء الكمون، التخميد الطيفي، التوليد الحتمي).`;
                    
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `${systemPrompt}\nالمستخدم يسأل: ${input}` }] }] })
                    });
                    
                    const data = await res.json();
                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "فشل الاتصال بطبقة الإدراك.";
                    setMessages(prev => [...prev, { id: Date.now()+1, role: 'ai', text: aiText }]);
                } catch (err) {
                    setMessages(prev => [...prev, { id: Date.now()+1, role: 'ai', text: "خطأ في معالجة الإشارة الطيفية." }]);
                } finally { setIsComputing(false); }
            };

            return (
                <div className="flex h-full w-full">
                    {/* القائمة اليمنى: التوثيق الرسمي والمعادلة */}
                    <div className="w-[400px] border-l border-white/5 bg-[#0a0a0a] p-8 flex flex-col gap-6 overflow-y-auto custom-scroll">
                        <div className="mb-4">
                            <h1 className="text-2xl font-black text-white tracking-tighter">F-LAMBDA <span className="text-indigo-500 underline">CORE</span></h1>
                            <p className="text-[10px] text-gray-500 uppercase tracking-[0.4em] mt-2">Whitepaper Protocol v5.1</p>
                        </div>

                        {/* صندوق المعادلة الرسمية */}
                        <div className="equation-box p-6 rounded-2xl border border-indigo-500/20 text-center">
                            <h3 className="text-[10px] text-indigo-400 font-bold uppercase mb-4 tracking-widest">The Unified Equation</h3>
                            <div className="text-lg font-mono text-white mb-2">
                                <span className="text-indigo-400">N</span> → [τ<sub>s</sub>] → <span className="text-emerald-400">ID</span> ← [G] → <span className="text-indigo-400">N'</span>
                            </div>
                            <p className="text-[10px] text-gray-500 italic">Constant: 15.0725</p>
                        </div>

                        {/* سجل البروتوكولات */}
                        <div className="flex flex-col gap-4">
                            <h3 className="text-[10px] text-gray-400 font-bold uppercase tracking-widest border-b border-white/5 pb-2">Active Protocols</h3>
                            <div className="logic-gate">
                                <h4 className="text-xs font-bold text-white">SPEC-84435B</h4>
                                <p className="text-[10px] text-gray-500">تم تفعيل عامل الكبت الطيفي لضمان سيادة البيانات.</p>
                            </div>
                            <div className="logic-gate">
                                <h4 className="text-xs font-bold text-white">GEN-RECOVERY</h4>
                                <p className="text-[10px] text-gray-500">آلية الاستعادة عبر المحرك G نشطة ومطابقة للهوية.</p>
                            </div>
                        </div>

                        {/* إعدادات المفتاح */}
                        <div className="mt-auto pt-6 border-t border-white/5">
                            <button onClick={() => setShowAuth(true)} className="text-[10px] text-gray-600 hover:text-indigo-400 transition-all uppercase tracking-widest">تحديث مفتاح الإدراك</button>
                        </div>
                    </div>

                    {/* منطقة المحادثة */}
                    <div className="flex-grow flex flex-col bg-[#050505]">
                        <div className="flex-grow overflow-y-auto p-12 space-y-10 custom-scroll">
                            {messages.map(m => (
                                <div key={m.id} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[85%] p-8 rounded-3xl ${m.role === 'user' ? 'bg-indigo-600 text-white' : 'bg-[#0f0f0f] border border-white/5 text-gray-300'} shadow-2xl transition-all`}>
                                        <div className="text-[16px] leading-[1.8] whitespace-pre-wrap">
                                            {m.text}
                                        </div>
                                    </div>
                                </div>
                            ))}
                            <div ref={chatRef} />
                        </div>

                        {/* المدخلات */}
                        <div className="p-12 bg-gradient-to-t from-black to-transparent">
                            <div className="max-w-4xl mx-auto relative">
                                {isComputing && <div className="absolute -top-6 right-6 text-[10px] text-indigo-400 uppercase animate-pulse font-bold">Computing Logic...</div>}
                                <input 
                                    className="w-full bg-[#0f0f0f] border border-white/10 rounded-2xl py-6 pr-14 pl-6 text-sm outline-none focus:border-indigo-500 transition-all"
                                    placeholder="اسألي عن أسرار المعالج أو اكتبي بروتوكولاً جديداً..."
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    onKeyPress={e => e.key === 'Enter' && executeQuery()}
                                />
                                <button onClick={executeQuery} className="absolute left-4 top-1/2 -translate-y-1/2 p-4 bg-indigo-600 rounded-xl hover:bg-indigo-500 transition-all">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="3"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Auth Modal */}
                    {showAuth && (
                        <div className="absolute inset-0 z-50 bg-black/95 flex items-center justify-center p-4 backdrop-blur-sm">
                            <div className="bg-[#0f0f0f] border border-white/10 p-10 rounded-[2.5rem] max-w-md w-full shadow-2xl">
                                <h2 className="text-xl font-bold text-white mb-6 text-center">مصادقة المهندس السيادي</h2>
                                <input 
                                    type="password"
                                    placeholder="أدخلي مفتاح API الخاص بكِ..."
                                    className="w-full bg-black border border-white/10 rounded-xl p-4 mb-6 text-sm outline-none focus:border-indigo-500"
                                    onBlur={e => {
                                        if(e.target.value) {
                                            localStorage.setItem('f_lambda_key', e.target.value);
                                            setApiKey(e.target.value);
                                            setShowAuth(false);
                                        }
                                    }}
                                />
                                <p className="text-[10px] text-gray-600 text-center uppercase tracking-widest leading-relaxed">المفتاح يُحفظ محلياً لضمان سيادة البيانات المطلقة.</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
